<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG to Canvas</title>
</head>
<body>
    <canvas id="myCanvas"></canvas>

    <script>
        const canvas = document.getElementById("myCanvas");
        const ctx = canvas.getContext("2d");
        const minWidth = 300
        const minHeight = 300

        async function fetchApi() {
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/todos/1')
                const data = await response.json()
                console.log(data)
                return data 
            }
            catch {
                console.error('Error fetching data: ', error)
            }
        }

        function createGradient(context, gradientId) {
            const gradient = context.createLinearGradient(0, 0, canvas.width, canvas.height);

            if (gradientId === "#Gradient-0") {
                gradient.addColorStop(0, "#196df3");
                gradient.addColorStop(1, "#25273d");
            } else if (gradientId === "#Gradient-1") {
                gradient.addColorStop(0, "#594de7");
                gradient.addColorStop(1, "#7b61ff");
            } else if (gradientId === "#Gradient-2") {
                gradient.addColorStop(0, "#1a6cf2");
                gradient.addColorStop(1, "#000");
            } else if (gradientId === "#Gradient-3") {
                gradient.addColorStop(0, "#ffffff");
                gradient.addColorStop(1, "#000000");
            } else if(gradientId === "#Gradient-4") {
                gradient.addColorStop(0.2, "#23263c")
                gradient.addColorStop(1, "#196df3")
            }
            return gradient;
        }


        function draw( apiData, percentData) {
            const width = Math.max(window.innerWidth, minWidth);
            const height = Math.max(window.innerHeight, minHeight);

            canvas.width = width;
            canvas.height = height;

            
            const scale = Math.min(width / 192, height / 192);
            ctx.scale(scale, scale);

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 96, 96, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-0");
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 96, 96, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-1");
            ctx.globalAlpha = 0.8;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();    
            ctx.ellipse(96, 96, 76, 76, 0, 0, 2 * Math.PI);
            ctx.fillStyle = "#0f2439";
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 96, 96, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-0");
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 96, 96, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-1");
            ctx.globalAlpha = 0.8;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.closePath();
            ctx.restore();
            
            ctx.save();
            ctx.beginPath();    
            ctx.ellipse(96, 96, 76, 76, 0, 0, 2 * Math.PI);
            ctx.fillStyle = "#0f2439";
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();    
            ctx.ellipse(96, 96, 79, 79, 0, 0, 2 * Math.PI);
            ctx.fillStyle = "#22263a";
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 79, 79, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-2");
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 96, 96, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-3");
            ctx.globalAlpha = 0.8;
            ctx.fill();
            ctx.globalAlpha = 1;
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 76, 76, 0, 0, 2 * Math.PI);
            ctx.fillStyle = "#0f2439";
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 79, 79, 0, 0, 2 * Math.PI);
            ctx.fillStyle = "#22263a"
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.beginPath();
            ctx.ellipse(96, 96, 79, 79, 0, 0, 2 * Math.PI);
            ctx.fillStyle = createGradient(ctx, "#Gradient-2");
            ctx.fill();
            ctx.closePath();
            ctx.restore();

            ctx.save();
            ctx.fillStyle = "#ffffff";
            ctx.font = "40px Roboto, Arial, sans-serif";
            ctx.textAlign = "start";
            ctx.textBaseline = "middle";
            ctx.fillText(apiData, 65, 96);
            ctx.restore();

            ctx.save();
            ctx.fillStyle = "#ffffff";
            ctx.font = "20px Roboto, Arial, sans-serif";
            ctx.textAlign = "start";
            ctx.textBaseline = "middle";
            ctx.fillText(percentData, 115, 100);
            ctx.restore();


            // var offsetDistance = 0;
            // var animationStartTime = null;
            // const path = new Path2D('M33.3-9.2c56 17.1 111.2-6.2 135-12.9l32.7 90.8c-18.2 6.6-123.8 46.5-157.8 37.7c-42.5-10.9-113.6-147.3-9.9-115.6');

            // function animate(currentTime) {
            //     if (!animationStartTime) {
            //      animationStartTime = currentTime;
            //     }

            //     // 경과 시간 계산
            //     var elapsedTime = currentTime - animationStartTime;

            //     // offset-distance 애니메이션 업데이트
            //     offsetDistance = (elapsedTime % 2000) / 20;

            //     // Canvas 초기화
            //     ctx.clearRect(0, 0, canvas.width, canvas.height);

            //     // 변환 및 그리기
            //     ctx.save();
            //     ctx.translate(-89.9, 107.8);
            //     ctx.translate(-92.1, -24.4);
            //     ctx.rotate(11 * Math.PI / 180);

            //     // cubic-bezier 기반 애니메이션 적용
            //     var animatedPath = new Path2D();
            //     animatedPath.addPath(path, { transform: { a: 1, b: 0, c: 0, d: 1, e: offsetDistance, f: 0 } });

            //     ctx.fillStyle = createGradient(ctx, "#Gradient-4");
            //     ctx.fill(animatedPath);
            //     ctx.restore();

            //     // 다음 프레임 요청
            //     requestAnimationFrame(animate);
            // }

            //     // 애니메이션 시작
            //     animate();

            // function animationDraw() {
            //   const element = new Path2D('M33.3-9.2c56 17.1 111.2-6.2 135-12.9l32.7 90.8c-18.2 6.6-123.8 46.5-157.8 37.7c-42.5-10.9-113.6-147.3-9.9-115.6Z')
              
            //   ctx.translate(-89.9, 107.8)

            //   ctx.save()

            //   ctx.translate(-92.1, -24.4)
            //   ctx.rotate(11 * Math.PI / 180)

            //   ctx.beginPath()
            //   ctx.fillStyle = createGradient(ctx, "#Gradient-4")
            //   ctx.fill(element)
            //   ctx.closePath()
            //   ctx.restore()
            // }

            // animationDraw()
        }

        fetchApi().then((res) => {
            const apiData = res.userId.toString() + '5'
            const percentData = '%'
            draw(apiData, percentData)
            
            window.addEventListener('resize', () => {
                draw(apiData, percentData)
            })
        })
    </script>
</body>
</html>
